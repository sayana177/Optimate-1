<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- basic -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- mobile metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <!-- site metas -->
    <title>EYE CARE</title>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- bootstrap css -->
    <link rel="stylesheet" href="{{ url_for('static',filename='css/bootstrap.min.css')}}">
    <!-- style css -->
    <link rel="stylesheet" href="{{url_for('static',filename='css/style.css')}}">
    <!-- Responsive-->
    <link rel="stylesheet" href="{{url_for('static',filename='css/responsive.css')}}">
    <!-- fevicon -->
    <link rel="icon" href="{{url_for('static',filename='images/fevicon.png')}}" type="image/gif" />
    <!-- Scrollbar Custom CSS -->
    <link rel="stylesheet" href="{{url_for('static', filename='css/jquery.mCustomScrollbar.min.css')}}">
    <!-- Tweaks for older IEs-->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
    <!-- owl stylesheets --> 
    <link rel="stylesheet" href="{{url_for('static',filename='css/owl.carousel.min.css')}}">
    <link rel="stylesheet" href="{{url_for('static',filename='css/owl.theme.default.min.css')}}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" media="screen">
  
    <style>
      .chat-container {
        max-width: 600px;
        margin: 20px auto;
        border: 1px solid #ccc;
        border-radius: 10px;
        overflow: hidden;
       
    }

    .chat-header {
        background-color: #333;
        color: #fff;
        padding: 10px;
        text-align: center;
    }

    .chat-messages {
        padding: 10px;
        overflow-y: auto;
        max-height: 500px;
    }

    .message {
        margin-bottom: 10px;
    }

    .message .sender {
        font-weight: bold;
        color: #333;
    }

    .message .text {
        background-color: #fff;
        padding: 5px 10px;
        border-radius: 10px;
        display: inline-block;
        max-width: 70%;
    }

    .user-message {
        text-align: right;
    }

    .user-message .text {
        background-color: #add8e6;
    }

    .input-container {
        padding: 10px;
        background-color: #f9f9f9;
        border-top: 1px solid #ccc;
    }

    .input-container input[type="text"] {
        width: 100%;
        padding: 8px;
        border-radius: 5px;
        border: 1px solid #ccc;
    }

    .input-container button {
        padding: 8px 15px;
        background-color: #333;
        color: #fff;
        border: none;
        border-radius: 5px;
        margin-left: 5px;
        cursor: pointer;
    }
  </style>
  
  </head>
  <body>
    <!-- header section start -->
    <div class="header_section">
      <nav class="destop_header navbar navbar-expand-lg navbar-light bg-light" style="height: 100px;">
        <div class="collapse navbar-collapse" id="navbarSupportedContent" style="margin-top: -20px;">
          <ul class="navbar-nav mr-auto" >
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('p_index')}}">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('p_about')}}">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('p_doctor')}}">Doctor</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('p_department')}}">Depatments</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('p_appoinment_list')}}">Appoinment</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('p_visiontest_new')}}">Vison Test</a>
            </li>  
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('p_eyetest')}}">Diseases Pridiction</a>
            </li> 
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('p_contact')}}">Contact</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('logout')}}">Logout</a>
            </li>
            <li class="nav-item active" style="margin-left: 30px;">
              <a class="nav-link" href="#">Hi, {{ session['username'] }}</a>
            </li>
          </ul>
          
        </div>
        
      </nav>
      <nav class="mobile_header navbar navbar-expand-lg navbar-light bg-light" >
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent2" aria-controls="navbarSupportedContent2" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent2">
          <ul class="navbar-nav mr-auto" >
            <li class="nav-item active" style="margin-left: 30px;">
              <a class="nav-link" href="#">Hi, {{ session['username'] }}</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('p_index')}}">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('p_about')}}">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('p_doctor')}}">Doctor</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('p_department')}}">Depatments</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('p_appoinment_list')}}">Appoinment</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('p_visiontest_new')}}">Vison Test</a>
            </li>  
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('p_eyetest')}}">Diseases Pridiction</a>
            </li> 
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('p_contact')}}">Contact</a>
            </li>
            <li class="nav-item active">
              <a class="nav-link" href="{{ url_for('logout')}}">Logout</a>
            </li> 
          </ul>
          <div style="color: red;">{{ session['username'] }}</div>
        </div>
       
      </nav>
    </div>
      <!-- header section end -->
      <!-- contact section start -->
      <div class="contact_section layout_padding">
        <div class="container">
          <div style="max-width: 600px; margin: 0 auto; padding: 20px; background-color: #fff; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1);">
            <h2 style="text-align: center;">Chat With {{ doct }}</h2>
            <div class="chat-container">
              <div class="chat-header">
                  Chat Box
              </div>
                <div class="chat-messages" id="chat-messages">
                  {% if messages %}
                  {% for msg in messages %}
                  {% if msg[2]==session['username'] %}
				  <div  style="float: left; text-align: left; display: block; width: 50%; padding: 5px; margin-top: 5px; background-color: rgb(255, 255, 255); border-radius: 10px;" id="chatMessages">{{ msg[1] }} <span style="text-align: right; float: right; margin-top: 20px; font-size: 6px;">{{ msg[5] }} &#10003</span></div><br><br><br>
                  {% else %}
				  <div  style="float: right; text-align: right; display: block; width: 50%; padding: 5px; margin-top: 5px; color: white; background-color: rgb(60, 172, 236); border-radius: 10px;" id="chatMessages">{{ msg[1] }} <span style="text-align: left; float: left; margin-top: 20px; font-size: 6px;">{{ msg[5] }} &#10003</span></div><br><br><br>
                  {% endif %}
                
                  {% endfor %}
                  {% endif %}
                </div>
              <div class="input-container">
                <form method="post" action="{{url_for('add_message')}}">
                  <input type="text" name="messageInput" id="messageInput" placeholder="Type your message..." autofocus>
                  <input type="hidden" name="doctor" id="doctor" value="{{ doct }}">
                  <button type="submit">Send</button>
                </form>
          </div>
        </div>
        </div>
      </div>
      </div>
      <!-- contact section end -->
      <!-- copyright section start -->
      <div class="copyright_section">
        <div class="container">
          <p class="copyright">&#169; Opti-mate 2024</p>
        </div>
      </div>

      <script>
        // Optionally, you can focus on the input field using JavaScript
        window.onload = function() {
          document.getElementById("messageInput").focus();
          var chatContainer = document.getElementById("chat-messages");
            chatContainer.scrollTop = chatContainer.scrollHeight;
        };
        </script>
      <!-- copyright section end -->
      <!-- Javascript files-->
      <script src="{{url_for('static',filename='js/jquery.min.js')}}"></script>
      <script src="{{url_for('static',filename='js/popper.min.js')}}"></script>
      <script src="{{url_for('static',filename='js/bootstrap.bundle.min.js')}}"></script>
      <script src="{{url_for('static',filename='js/jquery-3.0.0.min.js')}}"></script>
      <script src="{{url_for('static',filename='js/plugin.js')}}"></script>
      <!-- sidebar -->
      <script src="{{url_for('static',filename='js/jquery.mCustomScrollbar.concat.min.js')}}"></script>
      <script src="{{url_for('static',filename='js/custom.js')}}"></script>
      <!-- javascript --> 
      <script src="{{url_for('static',filename='js/owl.carousel.js')}}"></script>
      <script src="https:cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.js"></script>

      <script>
        var doct =document.getElementById('#doctor').value;
        var text =document.getElementById('#messageInput').value;
        fetch('/api/messages/add', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json'
    },
    body: JSON.stringify({ text: text, doct: doct })
})
.then(response => {
    if (response.ok) {
        console.log('Message sent successfully');
        // Optionally, update the UI to indicate success
    } else {
        console.error('Failed to send message');
        // Optionally, display an error message to the user
    }
})
.catch(error => {
    console.error('Error sending message:', error);
    // Optionally, display an error message to the user
});

        function sendMessage() {
            const messageInput = document.getElementById('message-input');
            const doctor = document.getElementById('doctor');
            const text = messageInput.value.trim();
            const doct = doctor.value.trim();
            if (text !== '') {
                fetch('/api/messages/add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ text, doct })
                })
                .then(response => response.json())
                .then(data => {
                    console.log(data.status);
                    fetchMessages();
                })
                .catch(error => console.error('Error sending message:', error));
            }
        }

        document.getElementById('send-button').addEventListener('click', sendMessage);

        fetchMessages();
</script>

     </body>
   </html>